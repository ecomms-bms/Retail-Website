<?php

/*/////////////////////////////////////////////////////////
 * LOCATION CHILD THEME INCLUDES
 * Add Custom Functions Files
/*/////////////////////////////////////////////////////////
require get_stylesheet_directory() . '/inc/acf.php';
require get_stylesheet_directory() . '/inc/custom-post-types.php';
require get_stylesheet_directory() . '/inc/woocommerce-custom.php';
require get_stylesheet_directory() . '/inc/admin-custom.php';
require get_stylesheet_directory() . '/inc/frontend-custom.php';
require get_stylesheet_directory() . '/inc/class-bms-frontend-scripts.php';


/***********************************************************
 * ////
 * //// Add Google Analytics Tracking Code
 * ////
 *************************************************************/
add_action( 'wp_footer', 'outrank_add_paypal_analytics_tracking' );
function outrank_add_paypal_analytics_tracking() {
	?>
    <script type="text/javascript">(function () {
            function f() {
                var e = document.createElement("script");
                e.type = "text/javascript";
                e.async = true;
                e.src = "https://paypal-eu-cdn.cloudiq.com/tag/7ac9ab88-c99b-4322-9398-479aa2470c78-jlysri5z.js";
                var t = document.getElementsByTagName("head")[0];
                t.appendChild(e)
            }

            f()
        })();</script>
	<?php
	/*<!-- PayPal BEGIN --> <script> ;(function(a,t,o,m,s){a[m]=a[m]||[];a[m].push({t:new Date().getTime(),event:'snippetRun'});var f=t.getElementsByTagName(o)[0],e=t.createElement(o),d=m!=='paypalDDL'?'&m='+m:'';e.async=!0;e.src='https://www.paypal.com/tagmanager/pptm.js?id='+s+d;f.parentNode.insertBefore(e,f);})(window,document,'script','paypalDDL','4e9051c9-0ca7-476e-991e-2db38592b968'); </script> <!-- PayPal END -->*/
}

/***********************************************************
 * ////
 * //// Add FontAwesome CSS
 * ////
 *************************************************************/
add_action( 'wp_enqueue_scripts', 'enqueue_load_fa' );
function enqueue_load_fa() {
	wp_enqueue_style( 'load-fa',
		'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css' );
}

/*/////////////////////////////////////////////////////////
 * LOCATION CHILD ADMIN CSS
 * Add Custom Admin CSS Files
/*/////////////////////////////////////////////////////////
add_action( 'admin_enqueue_scripts', 'batterymega_admin_style' );
function batterymega_admin_style() {
	wp_enqueue_style( 'batterymega-admin-styles',
		get_stylesheet_directory_uri() . '/assets/css/admin-custom.css' );
}

/***********************************************************
 * ////
 * //// Add Business Structured Data Markup To Footer
 * ////
 *************************************************************/
//add_action( 'wp_footer', 'add_business_schema_tofooter', 10 );
function add_business_schema_tofooter() {
	echo '
    <script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "LocalBusiness",
        "address": {
        "@type": "PostalAddress",
            "streetAddress": "Unit 29 Alexandra Way, Ashchurch",
            "addressLocality": "Tewkesbury",
            "addressRegion": "Gloucestershire",
            "postalCode": "GL20 8NB",
            "addressCountry": "GB"
            },
        "description": "Batterymegastore was created as a straightforward way for you to buy batteries at competitive prices either over the internet or via telephone.",
        "name": "Battery Megastore",
        "url": "https://www.batterymegastore.co.uk/",
        "logo": "https://www.batterymegastore.co.uk/wp-content/uploads/2019/10/logonewpng_3a6154628818d3798674d1b75587b915.png",
        "image": "https://www.batterymegastore.co.uk/wp-content/uploads/2021/09/Hankook-automotive-banner-scaled-1.jpg",
        "pricerange": "££",
        "email":"sales@batterymegastore.co.uk",
        "telephone": "01684 298800",
        "openingHours": [ "Mo-Fr 08:00-17:30" ],
        "sameAs" : [ "https://www.facebook.com/Batterymegastore", "https://twitter.com/batterymega", "https://www.instagram.com/batterymegastore/", "https://www.linkedin.com/company/battery-megastore/"],
        "hasMap" : "https://www.google.com/maps/place/Battery+Megastore/@52.0004945,-2.1192014,15z/data=!4m5!3m4!1s0x0:0xaa08c32d79954c93!8m2!3d52.0004945!4d-2.1192014",
        "geo": {
            "@type": "GeoCoordinates",
            "latitude": "52.0004945",
            "longitude": "-2.1192014"
            },
        "aggregateRating": {
            "@type": "AggregateRating",
            "ratingValue": "4.2",
            "ratingCount": "10"
             },
        "review": [
            {
                "@type": "Review",
                "author": "Radovan Stevovic",
                "datePublished": "2021-09-16",
                "reviewBody": "Amazing service (price ,payment, delivery) I bought car battery Varta N85 Blue Dynamic for £20 less than on e-bay or amazon. Delivery was next day. Im really happy.",
                "reviewRating": {
                  "@type": "Rating",
                  "bestRating": "5",
                  "ratingValue": "5",
                  "worstRating": "1"
                }
            },
            {
                "@type": "Review",
                "author": "Richard Baker",
                "datePublished": "2020-03-17",
                "reviewBody": "Cant recommend Petz 1st enough, they always provide fantastic service and never fail to deliver. Petz 1st go above and beyond to make sure youre happy as well as provide advice and guidance on a wide range of great products",
                "reviewRating": {
                  "@type": "Rating",
                  "bestRating": "5",
                  "ratingValue": "5",
                  "worstRating": "1"
                }
            },
            {
                "@type": "Review",
                "author": "Carol Atkinson",
                "datePublished": "2020-03-19",
                "reviewBody": "Very good choice of pet products at very good prices, excellent delivery service, the quality of the products are good.",
                "reviewRating": {
                  "@type": "Rating",
                  "bestRating": "5",
                  "ratingValue": "5",
                  "worstRating": "1"
                }
            }
        ]
    }
    </script>';
}


/*/////////////////////////////////////////////////////////
 * Global UPS Add To Header
 * Add Battery Megastore Global UPS to Header
/*/////////////////////////////////////////////////////////
add_action( 'thb_before_main', 'batterymegastore_header_ups' );
function batterymegastore_header_ups() {
	?>
    <div class="row wpb_row row-fluid show-for-large no-row-padding full-width-row no-column-padding ups-header row-has-fill">
        <div class="wpb_column columns medium-12 thb-dark-column small-12">
            <div class="vc_column-inner">
                <div class="wpb_wrapper ">
                    <div class="row wpb_row vc_inner row-fluid max_width no-column-padding text-center">
                        <div class="wpb_column columns medium-4 thb-dark-column small-12">
                            <div class="vc_column-inner ups-header-custominner">
                                <div class="wpb_wrapper br">
                                    <div class="wpb_text_column wpb_content_element">
                                        <div class="wpb_wrapper">
                                            <p><i class="fas fa-truck"></i>&nbsp;&nbsp;<span
                                                        style="color: #000000; font-size: 15px;"><b>Next Day Delivery*</b></span></p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="wpb_column columns medium-4 thb-dark-column has-fill small-12">
                            <div class="vc_column-inner ups-header-custominner">
                                <div class="wpb_wrapper br">
                                    <div class="wpb_text_column wpb_content_element  ">
                                        <div class="wpb_wrapper">
                                            <p><i class="fas fa-phone-alt"></i>&nbsp;&nbsp;<span
                                                        style="color: #000000; font-size: 15px;"><b>Need Help?</b> Call us on 01684 298800</span></p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="wpb_column columns medium-4 thb-dark-column small-12">
                            <div class="vc_column-inner ups-header-custominner">
                                <div class="wpb_wrapper">
                                    <div class="wpb_text_column wpb_content_element  ">
                                        <div class="wpb_wrapper">
                                            <p><i class="fas fa-car-battery"></i>&nbsp;&nbsp;<span
                                                        style="color: #000000; font-size: 15px;"><b>Correct Battery Fit</b> Guarantee</span></p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
	<?php
}

/*/////////////////////////////////////////////////////////
 * Action Scheduler
 * Only keep logs for 7 days
/*/////////////////////////////////////////////////////////
add_filter( 'action_scheduler_retention_period',
	'modify_action_schedule_retention_date' );
function modify_action_schedule_retention_date() {
	return DAY_IN_SECONDS * 7; // 7 Days
}

/** Disable All WooCommerce  Styles and Scripts Except Shop Pages*/
add_action( 'wp_enqueue_scripts', 'dequeue_woocommerce_styles_scripts', 15 );
function dequeue_woocommerce_styles_scripts() {
	if ( function_exists( 'is_woocommerce' ) ) {
		if ( ! is_woocommerce() && ! is_cart() && ! is_checkout() ) {
			# Styles
			wp_dequeue_style( 'woocommerce-general' );
			wp_dequeue_style( 'woocommerce-layout' );
			wp_dequeue_style( 'woocommerce-smallscreen' );
			wp_dequeue_style( 'woocommerce_frontend_styles' );
			wp_dequeue_style( 'woocommerce_fancybox_styles' );
			wp_dequeue_style( 'woocommerce_chosen_styles' );
			wp_dequeue_style( 'woocommerce_prettyPhoto_css' );
			wp_dequeue_style( 'wwp-wholesale' );
			wp_dequeue_style( 'wc-form-builder' );
			wp_dequeue_style( 'wc_warranty' );
			wp_dequeue_style( 'wc-bundle-style' );
			wp_dequeue_style( 'woo_discount_pro_style' );
			wp_dequeue_style( 'wc-sagepaydirect' );
            # Scripts
			wp_dequeue_script( 'wwp-wholesale' );
			wp_dequeue_script( 'wc_price_slider' );
			wp_dequeue_script( 'wc-single-product' );
			wp_dequeue_script( 'wc-add-to-cart' );
			wp_dequeue_script( 'wc-cart-fragments' );
			wp_dequeue_script( 'wc-checkout' );
			wp_dequeue_script( 'wc-add-to-cart-variation' );
			wp_dequeue_script( 'wc-single-product' );
			wp_dequeue_script( 'wc-cart' );
			wp_dequeue_script( 'wc-chosen' );
			wp_dequeue_script( 'woocommerce' );
			wp_dequeue_script( 'prettyPhoto' );
			wp_dequeue_script( 'prettyPhoto-init' );
			wp_dequeue_script( 'jquery-blockui' );
			wp_dequeue_script( 'jquery-placeholder' );
			wp_dequeue_script( 'fancybox' );
			wp_dequeue_script( 'jqueryui' );
		}
	}
}

if ( ! function_exists( 'write_log' ) ) {

    function write_log( $log ) {

        if ( is_array( $log ) || is_object( $log ) ) {
            error_log( print_r( $log, true ) );
        } else {
            error_log( $log );

        }
    }
}

function bms_word_limiter( $string, $limit = 20, $affix = '' ) {
  return preg_replace( '/[^A-Za-z0-9\.]$/', '', implode(' ', array_slice( explode(' ', $string), 0, $limit ) ) ).$affix;
}

add_action('admin_enqueue_scripts', 'enqueue_tinymce_for_edit_category');
function enqueue_tinymce_for_edit_category( $hook ) {
    if ( $hook === 'term.php' ) {
        wp_enqueue_editor();
    }
}

add_action('admin_footer', 'initialize_tinymce_for_custom_textareas');
function initialize_tinymce_for_custom_textareas() {
    ?>
    <script>
        jQuery(document).ready(function($) {
            const settings = {
                tinymce: {
                    toolbar: [
                        'link unlink | formatselect | bold italic | bullist numlist | separator | removeformat'
                    ]
                },
                quicktags: true
            };
            wp.editor.initialize('category_top_content', settings);
            wp.editor.initialize('category_bottom_content', settings);
        });
    </script>
    <?php
}






// add_action( 'woocommerce_after_shop_loop_item', 'woocommerce_template_loop_product_link_close', 5 );
add_filter( 'woocommerce_loop_add_to_cart_link', 'mish_before_after_btn', 10, 3 );

function mish_before_after_btn( $add_to_cart_html, $product, $args ){

	$after = '<a href = "https://www.bmstechnologies.co.uk/trade-enquiry/" class = "custom-enquiry-btn" >Trade Enquiry</a>'; // Add some text or HTML here as well

	return $add_to_cart_html . $after;
}